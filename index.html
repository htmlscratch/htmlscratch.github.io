<!DOCTYPE html>
<html>
<head>
    <title>HTML Block Engine</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>

    <style>
        body { font-family: sans-serif; background: #1e1e1e; color: white; margin: 0; overflow: hidden; }
        .header { height: 50px; display: flex; align-items: center; padding: 0 20px; background: #333; justify-content: space-between; }
        #blocklyDiv { height: calc(100vh - 50px); width: 60%; float: left; }
        #codeOutput { height: calc(100vh - 50px); width: 40%; float: right; background: #000; color: #0f0; padding: 20px; box-sizing: border-box; overflow-y: auto; white-space: pre-wrap; font-family: monospace; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>

    <div class="header">
        <span><b>HTML Block Engine</b></span>
        <button onclick="copyCode()">Copy HTML5 Code</button>
    </div>

    <div id="blocklyDiv"></div>
    <div id="codeOutput" id="generatedCode">Your HTML will appear here...</div>

    <xml id="toolbox" style="display: none">
        <block type="html_page"></block>
        <block type="html_title"></block>
        <block type="html_heading"></block>
        <block type="html_text"></block>
    </xml>

    <script>
        // 1. Define how the blocks look and what code they generate
        Blockly.Blocks['html_page'] = {
            init: function() {
                this.appendDummyInput().appendField("HTML5 Document");
                this.appendStatementInput("content").setCheck(null);
                this.setColour(230);
            }
        };

        Blockly.Blocks['html_heading'] = {
            init: function() {
                this.appendDummyInput().appendField("Heading").appendField(new Blockly.FieldTextInput("Hello World"), "TEXT");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(160);
            }
        };

        Blockly.Blocks['html_text'] = {
            init: function() {
                this.appendDummyInput().appendField("Paragraph").appendField(new Blockly.FieldTextInput("Type here..."), "TEXT");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(160);
            }
        };

        // 2. Define the Generator (Turning blocks into text)
        const htmlGenerator = new Blockly.Generator('HTML');
        
        htmlGenerator['html_page'] = function(block) {
            const statements = htmlGenerator.statementToCode(block, 'content');
            return `<!DOCTYPE html>\n<html>\n<body>\n${statements}</body>\n</html>`;
        };

        htmlGenerator['html_heading'] = function(block) {
            return `  <h1>${block.getFieldValue('TEXT')}</h1>\n`;
        };

        htmlGenerator['html_text'] = function(block) {
            return `  <p>${block.getFieldValue('TEXT')}</p>\n`;
        };

        // 3. Inject Blockly into the Div
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            scrollbars: true
        });

        // 4. Update the code window in real-time
        function updateCode() {
            const code = htmlGenerator.workspaceToCode(workspace);
            document.getElementById('codeOutput').innerText = code || "Drag blocks to start...";
        }
        workspace.addChangeListener(updateCode);

        // 5. Copy function
        function copyCode() {
            const code = htmlGenerator.workspaceToCode(workspace);
            navigator.clipboard.writeText(code);
            alert("Code copied to clipboard!");
        }
    </script>
</body>
</html>
