<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebBlock Engine</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/@blockly/field-colour"></script>

    <style>
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .toolbar { height: 60px; background: #2d2d2d; display: flex; align-items: center; padding: 0 20px; gap: 20px; border-bottom: 2px solid #444; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        #main { display: flex; flex: 1; }
        #blocklyDiv { width: 50%; height: 100%; }
        #sidebars { width: 50%; display: flex; flex-direction: column; border-left: 2px solid #444; background: #111; }
        .label { background: #333; padding: 8px 15px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #aaa; border-bottom: 1px solid #444; }
        #codeOutput { height: 35%; background: #000; color: #00ff41; padding: 15px; margin: 0; overflow: auto; font-family: 'Consolas', monospace; font-size: 13px; }
        #livePreview { flex: 1; background: white; border: none; width: 100%; }
        button { background: #4a90e2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #357abd; transform: translateY(-1px); }
    </style>
</head>
<body>

    <div class="toolbar">
        <div style="font-size: 20px; font-weight: bold; color: #4a90e2;">WebBlock <span style="color:white">Studio</span></div>
        <button onclick="copyCode()">Copy HTML5 Code</button>
    </div>

    <div id="main">
        <div id="blocklyDiv"></div>
        <div id="sidebars">
            <div class="label">Source Code</div>
            <pre id="codeOutput"></pre>
            <div class="label">Live Preview</div>
            <iframe id="livePreview"></iframe>
        </div>
    </div>

    <xml id="toolbox" style="display: none">
        <category name="HTML (Structure)" colour="160">
            <block type="html_main"></block>
            <block type="html_text"></block>
            <block type="html_button"></block>
        </category>
        <category name="CSS (Design)" colour="260">
            <block type="css_color"></block>
            <block type="css_font_size"></block>
        </category>
        <category name="JS (Logic)" colour="60">
            <block type="js_alert"></block>
            <block type="js_console"></block>
        </category>
    </xml>

    <script src="blocks.js"></script>
    <script src="generator.js"></script>

    <script>
        // Initialize Workspace
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            grid: { spacing: 20, length: 3, colour: '#333', snap: true },
            zoom: { controls: true, wheel: true, startScale: 1.0, maxScale: 3, minScale: 0.3, scaleSpeed: 1.2 },
            trashcan: true
        });

        function updateAll() {
            if (typeof htmlGenerator !== 'undefined') {
                const code = htmlGenerator.workspaceToCode(workspace);
                document.getElementById('codeOutput').textContent = code || "";
                
                // Update the Live Preview frame
                const previewFrame = document.getElementById('livePreview');
                const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                previewDoc.open();
                previewDoc.write(code);
                previewDoc.close();
            }
        }

        workspace.addChangeListener(updateAll);

        function copyCode() {
            const code = document.getElementById('codeOutput').textContent;
            navigator.clipboard.writeText(code);
            alert("Full website code copied to clipboard!");
        }
    </script>
</body>
</html>
